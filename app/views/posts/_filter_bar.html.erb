<section class="filter-bar">

  <div class="filter-bar__body">
    <form x-ref="form" action="<%= posts_path %>" method="get" class="filter-bar__grid">
      <!-- Always reset page to 1 when changing filters -->
      <input type="hidden" name="page" value="1">

      <!-- Filter by Platform -->
      <div class="filter-bar__field">
        <select name="post[platform]" class="filter-bar__select" @change="$refs.form.submit()">
          <option value="">All Platforms</option>
          <% platforms.each do |platform| %>
            <option value="<%= platform %>" <%= "selected" if filter[:platform] == platform %>>
              <%= platform.titleize %>
            </option>
          <% end %>
        </select>
      </div>

      <!-- Media type -->
      <div class="filter-bar__field">
        <select name="post[media_type]" class="filter-bar__select" @change="$refs.form.submit()">
          <option value="">All Media Types</option>
          <% media_types.each do |media_type| %>
            <option value="<%= media_type %>" <%= "selected" if filter[:media_type] == media_type %>>
              <%= media_type.to_s.titleize %>
            </option>
          <% end %>
        </select>
      </div>

      <div class="filter-bar__field">
        <select name="post[source_id]" class="filter-bar__select" @change="$refs.form.submit()">
          <option value="">All Sources</option>
          <% sources.each do |source| %>
            <option value="<%= source.id %>" <%= "selected" if filter[:source_id].to_s == source.id.to_s %>>
              <%= "#{source.platform} â€“ #{source.username}" %>
            </option>
          <% end %>
        </select>
      </div>
    </form>
  </div>

  <% if active_filters.any? %>
    <div class="filter-bar__active">
      <% active_filters.each do |f| %>
        <span class="filter-tag">
          <span class="filter-tag__label"><strong><%= f[:label] %></strong>:</span>
          <span class="filter-tag__value"><%= f[:value] %></span>
        </span>
      <% end %>

      <%= link_to "Clear", posts_path, class: "filter-bar__clear" %>
    </div>
  <% end %>
</section>